C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE OLED_12832
OBJECT MODULE PLACED IN .\output\oled_12832.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE code\oled_12832.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTE
                    -ND PRINT(.\output\oled_12832.lst) OBJECT(.\output\oled_12832.obj)

line level    source

   1          #include "oled_12832.h"
   2          #include "func_def.h"
   3          #include "MC96F6432.h"
   4          #include "gp_sub.h"
   5          #include "key_func.h"
   6          #include "rtc.h"
   7          #include "si7021.h"
   8          
   9          //
  10          // IC = SSD1306
  11          // IIC
  12          // 14PIN OLED
  13          // 128*32
  14          //
  15          
  16          #define LCD_SCL   P06
  17          #define LCD_SDA   P07
  18          #define LCD_RESET P13
  19          
  20          #define SDA_PORT   P0
  21          #define SDA_NUMBER (1 << 7)
  22          #define SDAIN()              \
  23              do {                     \
  24                  P0IO &= ~SDA_NUMBER; \
  25              } while (0)
  26          #define SDAOUT()            \
  27              do {                    \
  28                  P0IO |= SDA_NUMBER; \
  29              } while (0)
  30          
  31          #define SI7201_ADDR 0x78
  32          #define BRIGHTNESS  250
  33          #define DELAY_TIME  250
  34          
  35          static uint8_t g_letterTable[32];
  36          
  37          code uint8_t T8X16[] = {
  38              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*" ",
             -0*/
  39              0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x33, 0x30, 0x00, 0x00, 0x00, /*"!",
             -1*/
  40              0x00, 0x10, 0x0C, 0x06, 0x10, 0x0C, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*""",
             -2*/
  41              0x40, 0xC0, 0x78, 0x40, 0xC0, 0x78, 0x40, 0x00, 0x04, 0x3F, 0x04, 0x04, 0x3F, 0x04, 0x04, 0x00, /*"#",
             -3*/
  42              0x00, 0x70, 0x88, 0xFC, 0x08, 0x30, 0x00, 0x00, 0x00, 0x18, 0x20, 0xFF, 0x21, 0x1E, 0x00, 0x00, /*"$",
             -4*/
  43              0xF0, 0x08, 0xF0, 0x00, 0xE0, 0x18, 0x00, 0x00, 0x00, 0x21, 0x1C, 0x03, 0x1E, 0x21, 0x1E, 0x00, /*"%",
             -5*/
  44              0x00, 0xF0, 0x08, 0x88, 0x70, 0x00, 0x00, 0x00, 0x1E, 0x21, 0x23, 0x24, 0x19, 0x27, 0x21, 0x10, /*"&",
             -6*/
  45              0x10, 0x16, 0x0E, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*"'",
             -7*/
  46              0x00, 0x00, 0x00, 0xE0, 0x18, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x07, 0x18, 0x20, 0x40, 0x00, /*"(",
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 2   

             -8*/
  47              0x00, 0x02, 0x04, 0x18, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x40, 0x20, 0x18, 0x07, 0x00, 0x00, 0x00, /*")",
             -9*/
  48              0x40, 0x40, 0x80, 0xF0, 0x80, 0x40, 0x40, 0x00, 0x02, 0x02, 0x01, 0x0F, 0x01, 0x02, 0x02, 0x00, /*"*",
             -10*/
  49              0x00, 0x00, 0x00, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x1F, 0x01, 0x01, 0x01, 0x00, /*"+",
             -11*/
  50              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xB0, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, /*",",
             -12*/
  51              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, /*"-",
             -13*/
  52              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, /*".",
             -14*/
  53              0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x18, 0x04, 0x00, 0x60, 0x18, 0x06, 0x01, 0x00, 0x00, 0x00, /*"/",
             -15*/
  54              0x00, 0xE0, 0x10, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x00, 0x0F, 0x10, 0x20, 0x20, 0x10, 0x0F, 0x00, /*"0",
             -16*/
  55              0x00, 0x10, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F, 0x20, 0x20, 0x00, 0x00, /*"1",
             -17*/
  56              0x00, 0x70, 0x08, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x30, 0x28, 0x24, 0x22, 0x21, 0x30, 0x00, /*"2",
             -18*/
  57              0x00, 0x30, 0x08, 0x88, 0x88, 0x48, 0x30, 0x00, 0x00, 0x18, 0x20, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"3",
             -19*/
  58              0x00, 0x00, 0xC0, 0x20, 0x10, 0xF8, 0x00, 0x00, 0x00, 0x07, 0x04, 0x24, 0x24, 0x3F, 0x24, 0x00, /*"4",
             -20*/
  59              0x00, 0xF8, 0x08, 0x88, 0x88, 0x08, 0x08, 0x00, 0x00, 0x19, 0x21, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"5",
             -21*/
  60              0x00, 0xE0, 0x10, 0x88, 0x88, 0x18, 0x00, 0x00, 0x00, 0x0F, 0x11, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"6",
             -22*/
  61              0x00, 0x38, 0x08, 0x08, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, /*"7",
             -23*/
  62              0x00, 0x70, 0x88, 0x08, 0x08, 0x88, 0x70, 0x00, 0x00, 0x1C, 0x22, 0x21, 0x21, 0x22, 0x1C, 0x00, /*"8",
             -24*/
  63              0x00, 0xE0, 0x10, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x00, 0x00, 0x31, 0x22, 0x22, 0x11, 0x0F, 0x00, /*"9",
             -25*/
  64              0x00, 0x00, 0x00, 0xC0, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00, 0x00, 0x00, /*":",
             -26*/
  65              0x00, 0x00, 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x60, 0x00, 0x00, 0x00, 0x00, /*";",
             -27*/
  66              0x00, 0x00, 0x80, 0x40, 0x20, 0x10, 0x08, 0x00, 0x00, 0x01, 0x02, 0x04, 0x08, 0x10, 0x20, 0x00, /*"<",
             -28*/
  67              0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x40, 0x00, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x00, /*"=",
             -29*/
  68              0x00, 0x08, 0x10, 0x20, 0x40, 0x80, 0x00, 0x00, 0x00, 0x20, 0x10, 0x08, 0x04, 0x02, 0x01, 0x00, /*">",
             -30*/
  69              0x00, 0x70, 0x48, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x30, 0x36, 0x01, 0x00, 0x00, /*"?",
             -31*/
  70              0xC0, 0x30, 0xC8, 0x28, 0xE8, 0x10, 0xE0, 0x00, 0x07, 0x18, 0x27, 0x24, 0x23, 0x14, 0x0B, 0x00, /*"@",
             -32*/
  71              0x00, 0x00, 0xC0, 0x38, 0xE0, 0x00, 0x00, 0x00, 0x20, 0x3C, 0x23, 0x02, 0x02, 0x27, 0x38, 0x20, /*"A",
             -33*/
  72              0x08, 0xF8, 0x88, 0x88, 0x88, 0x70, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"B",
             -34*/
  73              0xC0, 0x30, 0x08, 0x08, 0x08, 0x08, 0x38, 0x00, 0x07, 0x18, 0x20, 0x20, 0x20, 0x10, 0x08, 0x00, /*"C",
             -35*/
  74              0x08, 0xF8, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x20, 0x3F, 0x20, 0x20, 0x20, 0x10, 0x0F, 0x00, /*"D",
             -36*/
  75              0x08, 0xF8, 0x88, 0x88, 0xE8, 0x08, 0x10, 0x00, 0x20, 0x3F, 0x20, 0x20, 0x23, 0x20, 0x18, 0x00, /*"E",
             -37*/
  76              0x08, 0xF8, 0x88, 0x88, 0xE8, 0x08, 0x10, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x03, 0x00, 0x00, 0x00, /*"F",
             -38*/
  77              0xC0, 0x30, 0x08, 0x08, 0x08, 0x38, 0x00, 0x00, 0x07, 0x18, 0x20, 0x20, 0x22, 0x1E, 0x02, 0x00, /*"G",
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 3   

             -39*/
  78              0x08, 0xF8, 0x08, 0x00, 0x00, 0x08, 0xF8, 0x08, 0x20, 0x3F, 0x21, 0x01, 0x01, 0x21, 0x3F, 0x20, /*"H",
             -40*/
  79              0x00, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F, 0x20, 0x20, 0x00, 0x00, /*"I",
             -41*/
  80              0x00, 0x00, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x00, 0xC0, 0x80, 0x80, 0x80, 0x7F, 0x00, 0x00, 0x00, /*"J",
             -42*/
  81              0x08, 0xF8, 0x88, 0xC0, 0x28, 0x18, 0x08, 0x00, 0x20, 0x3F, 0x20, 0x01, 0x26, 0x38, 0x20, 0x00, /*"K",
             -43*/
  82              0x08, 0xF8, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x20, 0x20, 0x20, 0x30, 0x00, /*"L",
             -44*/
  83              0x08, 0xF8, 0xF8, 0x00, 0xF8, 0xF8, 0x08, 0x00, 0x20, 0x3F, 0x00, 0x3F, 0x00, 0x3F, 0x20, 0x00, /*"M",
             -45*/
  84              0x08, 0xF8, 0x30, 0xC0, 0x00, 0x08, 0xF8, 0x08, 0x20, 0x3F, 0x20, 0x00, 0x07, 0x18, 0x3F, 0x00, /*"N",
             -46*/
  85              0xE0, 0x10, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x0F, 0x10, 0x20, 0x20, 0x20, 0x10, 0x0F, 0x00, /*"O",
             -47*/
  86              0x08, 0xF8, 0x08, 0x08, 0x08, 0x08, 0xF0, 0x00, 0x20, 0x3F, 0x21, 0x01, 0x01, 0x01, 0x00, 0x00, /*"P",
             -48*/
  87              0xE0, 0x10, 0x08, 0x08, 0x08, 0x10, 0xE0, 0x00, 0x0F, 0x18, 0x24, 0x24, 0x38, 0x50, 0x4F, 0x00, /*"Q",
             -49*/
  88              0x08, 0xF8, 0x88, 0x88, 0x88, 0x88, 0x70, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x03, 0x0C, 0x30, 0x20, /*"R",
             -50*/
  89              0x00, 0x70, 0x88, 0x08, 0x08, 0x08, 0x38, 0x00, 0x00, 0x38, 0x20, 0x21, 0x21, 0x22, 0x1C, 0x00, /*"S",
             -51*/
  90              0x18, 0x08, 0x08, 0xF8, 0x08, 0x08, 0x18, 0x00, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x00, 0x00, /*"T",
             -52*/
  91              0x08, 0xF8, 0x08, 0x00, 0x00, 0x08, 0xF8, 0x08, 0x00, 0x1F, 0x20, 0x20, 0x20, 0x20, 0x1F, 0x00, /*"U",
             -53*/
  92              0x08, 0x78, 0x88, 0x00, 0x00, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x07, 0x38, 0x0E, 0x01, 0x00, 0x00, /*"V",
             -54*/
  93              0xF8, 0x08, 0x00, 0xF8, 0x00, 0x08, 0xF8, 0x00, 0x03, 0x3C, 0x07, 0x00, 0x07, 0x3C, 0x03, 0x00, /*"W",
             -55*/
  94              0x08, 0x18, 0x68, 0x80, 0x80, 0x68, 0x18, 0x08, 0x20, 0x30, 0x2C, 0x03, 0x03, 0x2C, 0x30, 0x20, /*"X",
             -56*/
  95              0x08, 0x38, 0xC8, 0x00, 0xC8, 0x38, 0x08, 0x00, 0x00, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x00, 0x00, /*"Y",
             -57*/
  96              0x10, 0x08, 0x08, 0x08, 0xC8, 0x38, 0x08, 0x00, 0x20, 0x38, 0x26, 0x21, 0x20, 0x20, 0x18, 0x00, /*"Z",
             -58*/
  97              0x00, 0x00, 0x00, 0xFE, 0x02, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x7F, 0x40, 0x40, 0x40, 0x00, /*"[",
             -59*/
  98              0x00, 0x0C, 0x30, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x06, 0x38, 0xC0, 0x00, /*"\",
             -60*/
  99              0x00, 0x02, 0x02, 0x02, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x40, 0x7F, 0x00, 0x00, 0x00, /*"]",
             -61*/
 100              0x00, 0x00, 0x04, 0x02, 0x02, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*"^",
             -62*/
 101              0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, /*"_",
             -63*/
 102              0x00, 0x02, 0x02, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*"`",
             -64*/
 103              0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x19, 0x24, 0x22, 0x22, 0x22, 0x3F, 0x20, /*"a",
             -65*/
 104              0x08, 0xF8, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x11, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"b",
             -66*/
 105              0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x0E, 0x11, 0x20, 0x20, 0x20, 0x11, 0x00, /*"c",
             -67*/
 106              0x00, 0x00, 0x00, 0x80, 0x80, 0x88, 0xF8, 0x00, 0x00, 0x0E, 0x11, 0x20, 0x20, 0x10, 0x3F, 0x20, /*"d",
             -68*/
 107              0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x22, 0x22, 0x22, 0x22, 0x13, 0x00, /*"e",
             -69*/
 108              0x00, 0x80, 0x80, 0xF0, 0x88, 0x88, 0x88, 0x18, 0x00, 0x20, 0x20, 0x3F, 0x20, 0x20, 0x00, 0x00, /*"f",
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 4   

             -70*/
 109              0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x6B, 0x94, 0x94, 0x94, 0x93, 0x60, 0x00, /*"g",
             -71*/
 110              0x08, 0xF8, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x3F, 0x21, 0x00, 0x00, 0x20, 0x3F, 0x20, /*"h",
             -72*/
 111              0x00, 0x80, 0x98, 0x98, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F, 0x20, 0x20, 0x00, 0x00, /*"i",
             -73*/
 112              0x00, 0x00, 0x00, 0x80, 0x98, 0x98, 0x00, 0x00, 0x00, 0xC0, 0x80, 0x80, 0x80, 0x7F, 0x00, 0x00, /*"j",
             -74*/
 113              0x08, 0xF8, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x20, 0x3F, 0x24, 0x02, 0x2D, 0x30, 0x20, 0x00, /*"k",
             -75*/
 114              0x00, 0x08, 0x08, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x20, 0x20, 0x3F, 0x20, 0x20, 0x00, 0x00, /*"l",
             -76*/
 115              0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x20, 0x3F, 0x20, 0x00, 0x3F, 0x20, 0x00, 0x3F, /*"m",
             -77*/
 116              0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x3F, 0x21, 0x00, 0x00, 0x20, 0x3F, 0x20, /*"n",
             -78*/
 117              0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x1F, 0x20, 0x20, 0x20, 0x20, 0x1F, 0x00, /*"o",
             -79*/
 118              0x80, 0x80, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0xFF, 0xA1, 0x20, 0x20, 0x11, 0x0E, 0x00, /*"p",
             -80*/
 119              0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x0E, 0x11, 0x20, 0x20, 0xA0, 0xFF, 0x80, /*"q",
             -81*/
 120              0x80, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x20, 0x20, 0x3F, 0x21, 0x20, 0x00, 0x01, 0x00, /*"r",
             -82*/
 121              0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x33, 0x24, 0x24, 0x24, 0x24, 0x19, 0x00, /*"s",
             -83*/
 122              0x00, 0x80, 0x80, 0xE0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x20, 0x20, 0x00, 0x00, /*"t",
             -84*/
 123              0x80, 0x80, 0x00, 0x00, 0x00, 0x80, 0x80, 0x00, 0x00, 0x1F, 0x20, 0x20, 0x20, 0x10, 0x3F, 0x20, /*"u",
             -85*/
 124              0x80, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x00, 0x01, 0x0E, 0x30, 0x08, 0x06, 0x01, 0x00, /*"v",
             -86*/
 125              0x80, 0x80, 0x00, 0x80, 0x00, 0x80, 0x80, 0x80, 0x0F, 0x30, 0x0C, 0x03, 0x0C, 0x30, 0x0F, 0x00, /*"w",
             -87*/
 126              0x00, 0x80, 0x80, 0x00, 0x80, 0x80, 0x80, 0x00, 0x00, 0x20, 0x31, 0x2E, 0x0E, 0x31, 0x20, 0x00, /*"x",
             -88*/
 127              0x80, 0x80, 0x80, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x81, 0x8E, 0x70, 0x18, 0x06, 0x01, 0x00, /*"y",
             -89*/
 128              0x00, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x21, 0x30, 0x2C, 0x22, 0x21, 0x30, 0x00, /*"z",
             -90*/
 129              0x00, 0x00, 0x00, 0x00, 0x80, 0x7C, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x40, 0x40, /*"{",
             -91*/
 130              0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, /*"|",
             -92*/
 131              0x00, 0x02, 0x02, 0x7C, 0x80, 0x00, 0x00, 0x00, 0x00, 0x40, 0x40, 0x3F, 0x00, 0x00, 0x00, 0x00, /*"}",
             -93*/
 132              0x00, 0x06, 0x01, 0x01, 0x02, 0x02, 0x04, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, /*"~",
             -94*/
 133          };
 134          
 135          static void I2C_Delay(uint8_t delay)
 136          {
 137   1          while (delay-- != 0)
 138   1              ;
 139   1      }
 140          
 141          static void I2C_Start(void)
 142          {
 143   1          LCD_SDA = 1;
 144   1          I2C_Delay(DELAY_TIME);
 145   1          LCD_SCL = 1;
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 5   

 146   1          I2C_Delay(DELAY_TIME);
 147   1          LCD_SDA = 0;
 148   1          I2C_Delay(DELAY_TIME);
 149   1          LCD_SCL = 0;
 150   1          I2C_Delay(DELAY_TIME);
 151   1      }
 152          
 153          static void I2C_Stop(void)
 154          {
 155   1          LCD_SDA = 0;
 156   1          LCD_SCL = 1;
 157   1          I2C_Delay(DELAY_TIME);
 158   1          LCD_SDA = 1;
 159   1          I2C_Delay(DELAY_TIME);
 160   1          LCD_SCL = 1;
 161   1      }
 162          
 163          static BOOLEAN I2C_SendByte(uint8_t Byte)
 164          {
 165   1          BOOLEAN ret = false;
 166   1          uint8_t i;
 167   1          uint8_t read;
 168   1      
 169   1          for (i = 0; i < 8; i++) {
 170   2              LCD_SCL = 0;
 171   2              if (Byte & 0x80) {
 172   3                  LCD_SDA = 1;
 173   3              } else {
 174   3                  LCD_SDA = 0;
 175   3              }
 176   2              I2C_Delay(DELAY_TIME);
 177   2              LCD_SCL = 1;
 178   2              I2C_Delay(DELAY_TIME);
 179   2              Byte = Byte << 1;
 180   2          }
 181   1          LCD_SCL = 0;
 182   1      
 183   1          SDAIN();
 184   1          I2C_Delay(DELAY_TIME);
 185   1          LCD_SCL = 1;
 186   1          I2C_Delay(DELAY_TIME);
 187   1          read = SDA_PORT;
 188   1          if ((read & SDA_NUMBER) == SDA_NUMBER) {
 189   2              ret = true;
 190   2          }
 191   1          I2C_Delay(DELAY_TIME);
 192   1          LCD_SCL = 0;
 193   1          SDAOUT();
 194   1          I2C_Delay(DELAY_TIME);
 195   1      
 196   1          return ret;
 197   1      }
 198          
 199          static void OLED_WriteCmd(uint8_t Cmd)
 200          {
 201   1          I2C_Start();
 202   1          I2C_SendByte(SI7201_ADDR);
 203   1          I2C_SendByte(0x00);
 204   1          I2C_SendByte(Cmd);
 205   1          I2C_Stop();
 206   1      }
 207          
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 6   

 208          static void OLED_WriteData(uint8_t Data)
 209          {
 210   1          I2C_Start();
 211   1          I2C_SendByte(SI7201_ADDR);
 212   1          I2C_SendByte(0x40);
 213   1          I2C_SendByte(Data);
 214   1          I2C_Stop();
 215   1      }
 216          
 217          static void OLED_SetXY(uint8_t x, uint8_t y)
 218          {
 219   1          OLED_WriteCmd(0xb0 | y);
 220   1          OLED_WriteCmd(((0xf0 & x) >> 4) | 0x10);
 221   1          OLED_WriteCmd((0x0f & x) | 0x01);
 222   1      }
 223          
 224          void OLED_Off(void)
 225          {
 226   1          OLED_WriteCmd(0xae);
 227   1      }
 228          
 229          void OLED_Init(void)
 230          {
 231   1          LCD_RESET = 1;
 232   1          DelayMs(10);
 233   1          LCD_RESET = 0;
 234   1          DelayMs(10);
 235   1          LCD_RESET = 1;
 236   1          DelayMs(10);
 237   1      
 238   1          OLED_WriteCmd(0xae);       // Turn off oled panel
 239   1          OLED_WriteCmd(0x00);       // Set low column address
 240   1          OLED_WriteCmd(0x10);       // Set high column address
 241   1          OLED_WriteCmd(0x40);       // Set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
 242   1          OLED_WriteCmd(0x81);       // Set contrast control register
 243   1          OLED_WriteCmd(BRIGHTNESS); // Set SEG Output Current BRIGHTNESS
 244   1          OLED_WriteCmd(0xa1);       // Set SEG/Column Mapping     0xa0左右反置 0xa1正常
 245   1          OLED_WriteCmd(0xc8);       // Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
 246   1          OLED_WriteCmd(0xa6);       // Set normal display
 247   1          OLED_WriteCmd(0xa8);       // Set multiplex ratio(1 to 64)
 248   1          OLED_WriteCmd(0x3f);       // 1/64 duty
 249   1          OLED_WriteCmd(0xd3);       // Set display offset        Shift Mapping RAM Counter (0x00~0x3F)
 250   1          OLED_WriteCmd(0x00);       // Not offset
 251   1          OLED_WriteCmd(0xd5);       // Set display clock divide ratio/oscillator frequency
 252   1          OLED_WriteCmd(0x80);       // Set divide ratio, Set Clock as 100 Frames/Sec
 253   1          OLED_WriteCmd(0xd9);       // Set pre-charge period
 254   1          OLED_WriteCmd(0xf1);       // Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
 255   1          OLED_WriteCmd(0xda);       // Set com pins hardware configuration
 256   1          OLED_WriteCmd(0x12);       //
 257   1          OLED_WriteCmd(0xdb);       // Set vcomh
 258   1          OLED_WriteCmd(0x40);       // Set VCOM Deselect Level
 259   1          OLED_WriteCmd(0x20);       // Set Page Addressing Mode (0x00/0x01/0x02)
 260   1          OLED_WriteCmd(0x02);       //
 261   1          OLED_WriteCmd(0x8d);       // Set Charge Pump enable/disable
 262   1          OLED_WriteCmd(0x14);       // Set(0x10) disable
 263   1          OLED_WriteCmd(0xa4);       // Disable Entire Display On (0xa4/0xa5)
 264   1          OLED_WriteCmd(0xa6);       // Disable Inverse Display On (0xa6/a7)
 265   1          OLED_WriteCmd(0xaf);       // Turn on oled panel
 266   1          OLED_SetXY(0, 0);
 267   1      }
 268          
 269          void OLED_P8x16Str(void)
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 7   

 270          {
 271   1          uint8_t c, i, j;
 272   1          uint8_t z, T, x, y;
 273   1      
 274   1          x = 0x00;
 275   1          y = 0x00;
 276   1          j = 0x00;
 277   1      
 278   1          do {
 279   2              c = g_letterTable[j] - 32;
 280   2              OLED_SetXY(x, y);
 281   2              for (i = 0; i < 8; i++) {
 282   3                  T = 0x00;
 283   3                  z = T8X16[c * 16 + i];
 284   3                  if (z & 0x08) {
 285   4                      T |= 0x80;
 286   4                  }
 287   3                  if (z & 0x04) {
 288   4                      T |= 0x20;
 289   4                  }
 290   3                  if (z & 0x02) {
 291   4                      T |= 0x08;
 292   4                  }
 293   3                  if (z & 0x01) {
 294   4                      T |= 0x02;
 295   4                  }
 296   3                  OLED_WriteData(T);
 297   3              }
 298   2              OLED_SetXY(x, y + 1);
 299   2              for (i = 0; i < 8; i++) {
 300   3                  T = 0x00;
 301   3                  z = T8X16[c * 16 + i];
 302   3                  if (z & 0x80) {
 303   4                      T |= 0x80;
 304   4                  }
 305   3                  if (z & 0x40) {
 306   4                      T |= 0x20;
 307   4                  }
 308   3                  if (z & 0x20) {
 309   4                      T |= 0x08;
 310   4                  }
 311   3                  if (z & 0x10) {
 312   4                      T |= 0x02;
 313   4                  }
 314   3                  OLED_WriteData(T);
 315   3              }
 316   2              OLED_SetXY(x, y + 2);
 317   2              for (i = 0; i < 8; i++) {
 318   3                  T = 0x00;
 319   3                  z = T8X16[c * 16 + i + 8];
 320   3                  if (z & 0x08) {
 321   4                      T |= 0x80;
 322   4                  }
 323   3                  if (z & 0x04) {
 324   4                      T |= 0x20;
 325   4                  }
 326   3                  if (z & 0x02) {
 327   4                      T |= 0x08;
 328   4                  }
 329   3                  if (z & 0x01) {
 330   4                      T |= 0x02;
 331   4                  }
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 8   

 332   3                  OLED_WriteData(T);
 333   3              }
 334   2              OLED_SetXY(x, y + 3);
 335   2              for (i = 0; i < 8; i++) {
 336   3                  T = 0x00;
 337   3                  z = T8X16[c * 16 + i + 8];
 338   3                  if (z & 0x80) {
 339   4                      T |= 0x80;
 340   4                  }
 341   3                  if (z & 0x40) {
 342   4                      T |= 0x20;
 343   4                  }
 344   3                  if (z & 0x20) {
 345   4                      T |= 0x08;
 346   4                  }
 347   3                  if (z & 0x10) {
 348   4                      T |= 0x02;
 349   4                  }
 350   3                  OLED_WriteData(T);
 351   3              }
 352   2              x += 8;
 353   2              j++;
 354   2              if (j == 16) {
 355   3                  x = 0x00;
 356   3                  y = 4;
 357   3              }
 358   2          } while (j < 32);
 359   1      }
 360          
 361          code uint8_t WeekTable[8][3] = {
 362              'S', 'u', 'n', 'M', 'o', 'n', 'T', 'u', 'e', 'W', 'e', 'd', 'T', 'h', 'u', 'F', 'r', 'i', 'S', 't', 'a
             -',
 363          };
 364          
 365          void OLED_DispClock(void)
 366          {
 367   1          uint8_t i;
 368   1          enum SetItemType item = GetItem();
 369   1          struct TimeType *time = GetTime();
 370   1          uint8_t sec           = time->sec;
 371   1          uint8_t min           = time->min;
 372   1          uint8_t hour          = time->hour;
 373   1          uint8_t day           = time->day;
 374   1          uint8_t week          = time->week;
 375   1          uint8_t month         = time->month;
 376   1          uint16_t year         = time->year;
 377   1      
 378   1          for (i = 0; i < 32; i++) {
 379   2              g_letterTable[i] = ' ';
 380   2          }
 381   1      
 382   1          if (item == CLOCK_SET_YEAR) {
 383   2              if (GetTimeFlag(SET_COL_FLAG) || GetKeyFlag(HOLD_KEY_FLAG)) {
 384   3                  g_letterTable[1] = '2';
 385   3                  g_letterTable[2] = '0';
 386   3                  g_letterTable[3] = HexToAsc(year % 100 / 10);
 387   3                  g_letterTable[4] = HexToAsc(year % 100 % 10);
 388   3              }
 389   2          } else {
 390   2              g_letterTable[1] = '2';
 391   2              g_letterTable[2] = '0';
 392   2              g_letterTable[3] = HexToAsc(year % 100 / 10);
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 9   

 393   2              g_letterTable[4] = HexToAsc(year % 100 % 10);
 394   2          }
 395   1          g_letterTable[5] = '-';
 396   1          if (item == CLOCK_SET_MONTH) {
 397   2              if (GetTimeFlag(SET_COL_FLAG) || GetKeyFlag(HOLD_KEY_FLAG)) {
 398   3                  g_letterTable[6] = HexToAsc(month / 10);
 399   3                  g_letterTable[7] = HexToAsc(month % 10);
 400   3              }
 401   2          } else {
 402   2              g_letterTable[6] = HexToAsc(month / 10);
 403   2              g_letterTable[7] = HexToAsc(month % 10);
 404   2          }
 405   1          g_letterTable[8] = '-';
 406   1          if (item == CLOCK_SET_DAY) {
 407   2              if (GetTimeFlag(SET_COL_FLAG) || GetKeyFlag(HOLD_KEY_FLAG)) {
 408   3                  g_letterTable[9]  = HexToAsc(day / 10);
 409   3                  g_letterTable[10] = HexToAsc(day % 10);
 410   3              }
 411   2          } else {
 412   2              g_letterTable[9]  = HexToAsc(day / 10);
 413   2              g_letterTable[10] = HexToAsc(day % 10);
 414   2          }
 415   1          g_letterTable[12] = WeekTable[week][0];
 416   1          g_letterTable[13] = WeekTable[week][1];
 417   1          g_letterTable[14] = WeekTable[week][2];
 418   1      
 419   1          if (item == CLOCK_SET_HOUR) {
 420   2              if (GetTimeFlag(SET_COL_FLAG) || GetKeyFlag(HOLD_KEY_FLAG)) {
 421   3                  g_letterTable[20] = HexToAsc(hour / 10);
 422   3                  g_letterTable[21] = HexToAsc(hour % 10);
 423   3              }
 424   2          } else {
 425   2              g_letterTable[20] = HexToAsc(hour / 10);
 426   2              g_letterTable[21] = HexToAsc(hour % 10);
 427   2          }
 428   1          g_letterTable[22] = ':';
 429   1          if (item == CLOCK_SET_MIN) {
 430   2              if (GetTimeFlag(SET_COL_FLAG) || GetKeyFlag(HOLD_KEY_FLAG)) {
 431   3                  g_letterTable[23] = HexToAsc(min / 10);
 432   3                  g_letterTable[24] = HexToAsc(min % 10);
 433   3              }
 434   2          } else {
 435   2              g_letterTable[23] = HexToAsc(min / 10);
 436   2              g_letterTable[24] = HexToAsc(min % 10);
 437   2          }
 438   1      
 439   1          g_letterTable[25] = ':';
 440   1          g_letterTable[26] = HexToAsc(sec / 10);
 441   1          g_letterTable[27] = HexToAsc(sec % 10);
 442   1      }
 443          
 444          void OLED_DispTempHumi(void)
 445          {
 446   1          uint8_t i;
 447   1          uint8_t tmp0, tmp1;
 448   1          int8_t tmp2, tmp3;
 449   1          int16_t temp  = GetTemp();
 450   1          uint16_t humi = GetHumi();
 451   1      
 452   1          for (i = 0; i < 32; i++) {
 453   2              g_letterTable[i] = ' ';
 454   2          }
C51 COMPILER V9.59.0.0   OLED_12832                                                        05/31/2022 20:37:56 PAGE 10  

 455   1      
 456   1          tmp3 = temp / 100; //high
 457   1          tmp2 = temp % 100; //low
 458   1          if (temp < 0) {
 459   2              g_letterTable[4] = '-';
 460   2              tmp3             = 0 - tmp3;
 461   2              tmp2             = 0 - tmp2;
 462   2          }
 463   1          g_letterTable[5]  = HexToAsc(tmp3 / 10);
 464   1          g_letterTable[6]  = HexToAsc(tmp3 % 10);
 465   1          g_letterTable[7]  = '.';
 466   1          g_letterTable[8]  = HexToAsc(tmp2 / 10);
 467   1          g_letterTable[9]  = HexToAsc(tmp2 % 10);
 468   1          g_letterTable[10] = 'C';
 469   1      
 470   1          tmp1                   = humi / 100; //high
 471   1          tmp0                   = humi % 100; //low
 472   1          g_letterTable[16 + 5]  = HexToAsc(tmp1 / 10);
 473   1          g_letterTable[16 + 6]  = HexToAsc(tmp1 % 10);
 474   1          g_letterTable[16 + 7]  = '.';
 475   1          g_letterTable[16 + 8]  = HexToAsc(tmp0 / 10);
 476   1          g_letterTable[16 + 9]  = HexToAsc(tmp0 % 10);
 477   1          g_letterTable[16 + 10] = '%';
 478   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1470    ----
   CONSTANT SIZE    =   1544    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     32      22
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
