C51 COMPILER V9.59.0.0   COMMON                                                            05/31/2022 20:33:57 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE COMMON
OBJECT MODULE PLACED IN .\output\common.obj
COMPILER INVOKED BY: d:\Keil_v5\C51\BIN\C51.EXE code\common.c ROM(COMPACT) OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND P
                    -RINT(.\output\common.lst) OBJECT(.\output\common.obj)

line level    source

   1          #include "common.h"
   2          #include "func_def.h"
   3          #include "key_func.h"
   4          #include "display.h"
   5          #include "oled_12832.h"
   6          #include "gp_sub.h"
   7          #include "si7021.h"
   8          #include "rtc.h"
   9          
  10          static uint16_t g_stopModeCtr;
  11          
  12          void SetDisplayTime(uint16_t time)
  13          {
  14   1          g_stopModeCtr = time;
  15   1      }
  16          
  17          static void StopModeCountDec(void)
  18          {
  19   1          if (g_stopModeCtr) {
  20   2              g_stopModeCtr--;
  21   2          }
  22   1      }
  23          
  24          static void AllCtrRun(void)
  25          {
  26   1          SetModeCountDec();
  27   1          DispChangeCtr();
  28   1          StopModeCountDec();
  29   1      }
  30          
  31          static void StopMode(void)
  32          {
  33   1          if (g_stopModeCtr) {
  34   2              return;
  35   2          }
  36   1      
  37   1          OLED_Off();
  38   1      }
  39          
  40          void COMMON_Init(void)
  41          {
  42   1          DelayMs(1000);
  43   1          DelayUs(1000);
  44   1          SI7021_SampleTempHumi();
  45   1          TimeInit();
  46   1          OLED_Init();
  47   1          SetDisplayTime(DISPLAY_10MIN_TIME);
  48   1      }
  49          
  50          void COMMON_Process(void)
  51          {
  52   1          if (GetTimeFlag(SET_500MS_FLAG) || GetKeyFlag(KEY_FLAG)) {
  53   2              if (GetTimeFlag(SET_500MS_FLAG)) {
  54   3                  ResetTimeFlag(SET_500MS_FLAG);
C51 COMPILER V9.59.0.0   COMMON                                                            05/31/2022 20:33:57 PAGE 2   

  55   3                  IncHoldKeyCtr();
  56   3                  AllCtrRun();
  57   3                  StopMode();
  58   3              }
  59   2      
  60   2              if (GetKeyFlag(KEY_FLAG)) {
  61   3                  ResetKeyFlag(KEY_FLAG);
  62   3                  ScanKey();
  63   3                  if (GetKeyFlag(PUSH_KEY_FLAG)) {
  64   4                      PushKeyFunc();
  65   4                  } else {
  66   4                      ReleKeyFunc();
  67   4                  }
  68   3              }
  69   2              Display();
  70   2          }
  71   1      
  72   1          if (GetTimeFlag(SET_1000MS_FLAG)) {
  73   2              ResetTimeFlag(SET_1000MS_FLAG);
  74   2              ClockRun();
  75   2              SI7021_SampleTempHumi();
  76   2          }
  77   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    156    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
